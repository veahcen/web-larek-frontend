# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

# Данные и типы данных, используемые в приложении

Карточка

```
export interface IProductCard {
  _id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
  inBasket: boolean;
  addToBasket(): void;
  removeFromBasket(): void;
}
```

Форма заказа

```
export interface IFormOrder {
  _payMethod: string;
  _address: string;
  _email: string;
  _phone: string;
  _formErrors: string;
  _items: TCardInBasket[];

  set payMethod(pay: string);
  get payMethod(): string;
  set address(address: string);
  get address(): string;
  set email(email: string);
  get email(): string;
  set phone(phone: string);
  get phone(): string;
  set items(items: TCardInBasket[]);
  get items(): TCardInBasket[];
  validateOrder(): void;
  clearOrder(): void;
  validdatePayMethod(): void;
  validateAddres(): void;
  validateEmail(): void;
  validatePhone(): void;
  postOrder(): void;
}
```

Интерфейс для модели данных

```
export interface IData {
  _catalog: IProductCard[];
  _order: IFormOrder;
  _preview: IProductCard;

  set catalog(cards: IProductCard[]);
  get catalog(): IProductCard[];
  set order(order: IFormOrder);
  get order(): IFormOrder;
  set preview(order: IProductCard);
  get preview(): IProductCard;
  cardInBasket(card: IProductCard): boolean;
  get basketTotaalPrice(): number;
  get totalBasketLength(): number;
  get idCardsFromBasket(): string[];
  clearBasket(): void;
}
```

Данные для отображения карточки на главной странице

```
export type TCardMain = Pick<IProductCard, 'image' | 'title' | 'category' | 'price'>;
```

Основные данные для отображения карточек товаров в корзине

```
export type TCardInBasket = Pick<IProductCard, 'title' | 'price'>;
```

Данные для заполнения полей с информацией в первой части формы

```
export type TAddressAndPay = Pick<IFormOrder, 'payMethod' | 'address'>;
```

Данные для заполнения полей с информацией во второй части формы

```
export type TEmailAndPhone = Pick<IFormOrder, 'email' | 'phone'>;
```

Интерфейс для отправки запроса на совпршение сделки
```
export interface IOrderApi {
  items: string[];
  total: number;
}
```

Интерфейс для получения ответа зпроса на сделку
```
export interface IOrderResult {
  id: string;
	total: number;
}
```


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `off` - снять подписку на событие
- `emit` - инициализация события
- `onAll` - Слушать все события
- `offAll` - Сбросить все обработчики
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

#### Класс Components
Базовый класс для наследования модели отображения. Реализует базовые элементы работы с элементами, такие как переключение классов, установка текста у элемента и т.д.

#### Класс Model
Базовый класс для компонентов модели данных. Позволяем связать переданный данные со свойствами объекта (реализуется в конструкторе) и инициализировать вызов именованных событий через метод emitChanges.

### Слой данных

#### ProductCard
Класс отвечает за хранение и логику работы с корзиной на добавление и удаление ее оттуда. Структура карточки определена ответом с сервера.


#### FormOrder
Класс который отвечает за процесс оформления заказа. Содержит свойства, которые отображаются на полях соответствующих форм и реализует логику валидации свойств. Изменения в любом из свойств вызывают проверку всех полей.

#### Data
Класс, который позволяет отслеживать состояние приложения. 
- _catalog - спосок лотов на странице.
- _order - состояние заказа.
- _preview - карточка для просмотра ее в модальном окне.
Также отслеживает товары в корзине.

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Page
Класс предназначен для отображения наполнения главной страницы.

Поля класса:
- _counter: HTMLElement - элемент разметки с количеством товаров в корзине.
- _gallery: HTMLElement - элемент разметки с карточками на странице.
- _wrapper: HTMLElement - элемент разметки для блокировки прокрутки на странице.
- _basket: HTMLButtonElement - элемент разметки с кнопкой, для открытыя корзины.

Методы:
- set counter(value: number): void - метод для установки количества элементов в корзине.
- set cardsInPage(items: HTMLElement[]): void - етод для установки карточек на странице.
- set loked(value: boolean): void - метод блокировки скрола.

#### Класс Modal
Класс предназначен для рендера модального окна с определенным контентом.

Поля класса:
- _closeButton: HTMLButtonElement - элемент разметки c кнопкjq для закрытия модального окна.
- _content: HTMLElement - элемент разметки c контентjv модального окна.

Методы:
- set content - метод для установки контента в модальном окне.
- open(): void - метод для открытия модального окна.
- close(): void - метод для закрытия модального окна.
- render(data: IModal): HTMLElement - метод для рендера контента

#### Класс Basket
Класс предназначен для представления корзины с определенным контентом.

Поля класса:
- _list: HTMLElement - элемент разметки для списка.
- _total: HTMLElement - элемент разметки c общей стоимостью заказа.
- buttom: HTMLElement - элемент разметки с кнопкой оформления заказа.

Методы:
- set items(items: HTMLElement[]): void - установка содержимого корзины.
- set total(total: number): void - установка общей стоимости.
- set valid(value: boolean): void - определение валидности для оформления заказа.

#### Класс BasketItem
Класс предназначен для представления корзины с определенным контентом.

Поля класса:
- _index: HTMLElement - элемент разметки в номера корзине.
- _title: HTMLElement - элемент разметки заголовка карточки.
- _price: HTMLElement- элемент разметки цены карточки.
- _deleteBtn: HTMLButtonElement - элемент разметки с кнопкой удаления из списка корзины.

Методы:
- set index(value: number) - метод установки номера в списке корзины.
- set title(value: string) - метод установки заголовка.
- set price(value: number) - метод установки цены.

#### Класс Card
Класс предназначен для представления корзины с определенным контентом.

Поля класса:
- _category: HTMLElement - элемент разметки с категорией карточки.
- _title: HTMLElement - элемент разметки с заголовком карточки.
- _image?: HTMLImageElement - элемент разметки с картинкой карточки.
- _description?: HTMLElement - элемент разметки с описанием карточки.
- _button?: HTMLButtonElement - элемент разметки с кнопкой карточки.
- _price?: HTMLElement - элемент разметки с ценой карточки.

Методы:
- set category(value: string) - метод для установки категории карточки.
- set title(value: string) - метод для установки заголовка карточки.
- set image(value: string) - метод для установки картинки карточки.
- set description(value: string) - метод для установки описания карточки.
- set button(value: string) - метод для установки кнопки карточки с определенным текстом.
- set price(value: number) - метод для установки цены карточки.

#### Класс FirstStepOrder
Класс для отображения первой части заказа.

Поля класса:
- payMethodCont: HTMLDivElement - элемент разметки с методами оплаты.
- payMethodButtons: HTMLButtonElement[] - массив с элементами кнопок.

Методы:
- payMethodChoise(method: string): void - выбор метода оплаты для выделения кнопки
- set payment(value: string) - метод для установки оплаты.
- set address(value: IPaymentType) - метод для установки адреса.

#### Класс SecondStepOrder
Класс для отображения второй части заказа.

Методы:
- set phone(value: string) - метод для установки телефона.
- set email(value: string) - метод для установки почты.

#### Класс SuccsesOrder 
Класс представления, определяющий отображение основной информации об оформленном заказе.

Поля класса:
_close: HTMLElement  - элемент разметки для закрытия.
_total: HTMLElement  - элемент разметки где указана полная стоимость заказа.

Методы:
set total(value: number) - метод для установки общей суммы заказа.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

#### Класс LarekApi
Реализует методы для взаимодействия с сервером, такие как получение списка карточек, получение карточки и отправка запроса на заказ.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*

`catalog:changed` - подгружаем доступные лоты
`card:open` - открываем карточку лота для просмотра
`basket:open` - открываем корзину
`lot:changed` - добавляем/удаляем лот из корзины
`formErrors:changed` - проверяем форму отправки
`order_payment:open` - начинаем оформление заказа
`firstOrder:submit` - заполнили первую форму
`secondContacts:submit` - заполнили вторую форму
`order:post` - завершаем заказ
`payment:changed` - выбираем способ оплаты
`order.address:change` - изменили адрес доставки
`contacts.email:change` - изменили почту для связи
`contacts.phone:change` - изменили телефон для связи
`modal:open` - блокировка при открытии модального окна
`modal:close` - снятие блокировки при закрытии модального окна